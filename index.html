<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrÃ¡ctica de Polinomios - Interactiva</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .fraction { display: inline-flex; flex-direction: column; align-items: center; vertical-align: middle; margin: 0 3px; }
        .fraction .num { border-bottom: 2px solid currentColor; padding: 0 5px 2px; }
        .fraction .den { padding: 2px 5px 0; }
        sup { font-size: 0.65em; vertical-align: super; }
        .answer-btn { transition: all 0.2s; }
        .answer-btn:hover { transform: scale(1.03); }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-8px); } 75% { transform: translateX(8px); } }
        .shake { animation: shake 0.4s; }
    </style>
</head>
<body class="bg-gradient-to-br from-orange-100 via-blue-100 to-orange-200 min-h-screen">
    <div id="app"></div>
    <script>
        // BASE DE DATOS COMPLETA DE EJERCICIOS
        const DB = {
            // SUMAS Y RESTAS - MONOMIOS BÃSICOS
            "sr-mon-1": [
                { q: "3x + 5x", a: "8x", opts: ["8x", "8xÂ²", "15x", "2x"], steps: ["Sumamos coeficientes: 3 + 5 = 8", "Mantenemos la variable: x", "Resultado: 8x"] },
                { q: "7xÂ² - 3xÂ²", a: "4xÂ²", opts: ["4xÂ²", "4xâ´", "10xÂ²", "4x"], steps: ["Restamos coeficientes: 7 - 3 = 4", "Mantenemos xÂ²", "Resultado: 4xÂ²"] },
                { q: "9y + 2y", a: "11y", opts: ["11y", "11yÂ²", "7y", "18y"], steps: ["9 + 2 = 11", "= 11y"] },
                { q: "12a - 5a", a: "7a", opts: ["7a", "17a", "7aÂ²", "7"], steps: ["12 - 5 = 7", "= 7a"] }
            ],
            // SUMAS Y RESTAS - MONOMIOS CON NEGATIVOS
            "sr-mon-2": [
                { q: "-4x + 9x", a: "5x", opts: ["5x", "-5x", "13x", "-13x"], steps: ["-4 + 9 = 5", "= 5x"] },
                { q: "-7y - 3y", a: "-10y", opts: ["-10y", "10y", "-4y", "4y"], steps: ["-7 - 3 = -10", "= -10y"] },
                { q: "6aÂ² - 11aÂ²", a: "-5aÂ²", opts: ["-5aÂ²", "5aÂ²", "-5aâ´", "5aâ´"], steps: ["6 - 11 = -5", "= -5aÂ²"] },
                { q: "-8m + 3m", a: "-5m", opts: ["-5m", "5m", "-11m", "11m"], steps: ["-8 + 3 = -5", "= -5m"] }
            ],
            // SUMAS Y RESTAS - POLINOMIOS BÃSICOS
            "sr-pol-1": [
                { q: "(2x + 3) + (x + 5)", a: "3x + 8", opts: ["3x + 8", "2x + 8", "3x + 5", "2xÂ² + 8"], steps: ["2x + 3 + x + 5", "(2x + x) + (3 + 5)", "= 3x + 8"] },
                { q: "(5xÂ² + 2x) + (3xÂ² + x)", a: "8xÂ² + 3x", opts: ["8xÂ² + 3x", "8xâ´ + 3xÂ²", "5xÂ² + 3x", "8xÂ² + 2x"], steps: ["(5xÂ² + 3xÂ²) + (2x + x)", "= 8xÂ² + 3x"] },
                { q: "(4y + 7) - (y + 2)", a: "3y + 5", opts: ["3y + 5", "5y + 9", "3y + 9", "5y + 5"], steps: ["4y + 7 - y - 2", "(4y - y) + (7 - 2)", "= 3y + 5"] }
            ],
            // MULTIPLICACIÃ“N - MONOMIOS BÃSICOS
            "m-mon-1": [
                { q: "2x Â· 3x", a: "6xÂ²", opts: ["6xÂ²", "5xÂ²", "6x", "5x"], steps: ["Coef: 2 Â· 3 = 6", "Exp: x Â· x = xÂ²", "= 6xÂ²"] },
                { q: "5y Â· 2y", a: "10yÂ²", opts: ["10yÂ²", "7yÂ²", "10y", "7y"], steps: ["5 Â· 2 = 10", "y Â· y = yÂ²", "= 10yÂ²"] },
                { q: "4a Â· 3b", a: "12ab", opts: ["12ab", "7ab", "12aÂ²bÂ²", "12"], steps: ["4 Â· 3 = 12", "a Â· b = ab", "= 12ab"] },
                { q: "3xÂ² Â· 4x", a: "12xÂ³", opts: ["12xÂ³", "12xÂ²", "7xÂ³", "12x"], steps: ["3 Â· 4 = 12", "xÂ² Â· x = xÂ³", "= 12xÂ³"] }
            ],
            // MULTIPLICACIÃ“N - MONOMIOS CON NEGATIVOS
            "m-mon-2": [
                { q: "(-3x) Â· 4x", a: "-12xÂ²", opts: ["-12xÂ²", "12xÂ²", "-12x", "12x"], steps: ["-3 Â· 4 = -12", "x Â· x = xÂ²", "= -12xÂ²"] },
                { q: "(-2y) Â· (-5y)", a: "10yÂ²", opts: ["10yÂ²", "-10yÂ²", "10y", "-10y"], steps: ["-2 Â· -5 = 10", "y Â· y = yÂ²", "= 10yÂ²"] },
                { q: "6aÂ² Â· (-2a)", a: "-12aÂ³", opts: ["-12aÂ³", "12aÂ³", "-12aÂ²", "12aÂ²"], steps: ["6 Â· -2 = -12", "aÂ² Â· a = aÂ³", "= -12aÂ³"] }
            ],
            // MULTIPLICACIÃ“N - MONOMIO POR POLINOMIO
            "m-monpol-1": [
                { q: "2(x + 3)", a: "2x + 6", opts: ["2x + 6", "2x + 3", "2x + 5", "x + 6"], steps: ["Distributiva: 2Â·x + 2Â·3", "= 2x + 6"] },
                { q: "3x(2x + 1)", a: "6xÂ² + 3x", opts: ["6xÂ² + 3x", "6x + 3", "5xÂ² + 3x", "6xÂ² + 1"], steps: ["3xÂ·2x + 3xÂ·1", "= 6xÂ² + 3x"] },
                { q: "4(2y - 5)", a: "8y - 20", opts: ["8y - 20", "8y - 5", "6y - 20", "8y + 20"], steps: ["4Â·2y + 4Â·(-5)", "= 8y - 20"] }
            ],
            // MULTIPLICACIÃ“N - POLINOMIOS
            "m-pol-1": [
                { q: "(x + 2)(x + 3)", a: "xÂ² + 5x + 6", opts: ["xÂ² + 5x + 6", "xÂ² + 6x + 5", "xÂ² + 3x + 6", "2xÂ² + 5x + 6"], steps: ["xÂ·x + xÂ·3 + 2Â·x + 2Â·3", "xÂ² + 3x + 2x + 6", "= xÂ² + 5x + 6"] },
                { q: "(x + 1)(x + 4)", a: "xÂ² + 5x + 4", opts: ["xÂ² + 5x + 4", "xÂ² + 4x + 4", "xÂ² + 4x + 1", "xÂ² + 5x + 1"], steps: ["xÂ² + 4x + x + 4", "= xÂ² + 5x + 4"] },
                { q: "(2x + 1)(x + 3)", a: "2xÂ² + 7x + 3", opts: ["2xÂ² + 7x + 3", "2xÂ² + 6x + 3", "xÂ² + 7x + 3", "2xÂ² + 4x + 3"], steps: ["2xÂ² + 6x + x + 3", "= 2xÂ² + 7x + 3"] }
            ]
        };

        // ESTRUCTURA DE BLOQUES
        const BLOQUES = {
            "suma-resta": {
                nombre: "SUMAS Y RESTAS",
                icon: "â•â–",
                color: "from-orange-400 to-orange-600",
                subbloques: {
                    "mon-bas": { nombre: "Monomios bÃ¡sicos", db: "sr-mon-1" },
                    "mon-neg": { nombre: "Monomios negativos", db: "sr-mon-2" },
                    "pol-bas": { nombre: "Polinomios bÃ¡sicos", db: "sr-pol-1" }
                }
            },
            "mult": {
                nombre: "MULTIPLICACIÃ“N",
                icon: "âœ–ï¸",
                color: "from-blue-400 to-blue-600",
                subbloques: {
                    "mon-bas": { nombre: "Monomios bÃ¡sicos", db: "m-mon-1" },
                    "mon-neg": { nombre: "Monomios negativos", db: "m-mon-2" },
                    "monpol": { nombre: "Monomio Ã— Polinomio", db: "m-monpol-1" },
                    "pol": { nombre: "Polinomios", db: "m-pol-1" }
                }
            }
        };

        // ESTADO
        let state = {
            nombre: localStorage.getItem('polyNombre') || '',
            bloque: null,
            subbloque: null,
            ejercIdx: 0,
            intento: 0,
            similar: 0,
            mostrarExp: false,
            correcto: null,
            historial: JSON.parse(localStorage.getItem('polyHist') || '[]')
        };

        function guardar() {
            localStorage.setItem('polyNombre', state.nombre);
            localStorage.setItem('polyHist', JSON.stringify(state.historial));
        }

        function getEjercicios() {
            if (!state.subbloque) return [];
            const sub = BLOQUES[state.bloque].subbloques[state.subbloque];
            return DB[sub.db] || [];
        }

        function verificar(respuesta) {
            const ejs = getEjercicios();
            const ej = ejs[state.ejercIdx];
            const ok = respuesta.trim() === ej.a.trim();
            
            state.correcto = ok;
            state.mostrarExp = true;
            state.historial.push({
                pregunta: ej.q,
                respuesta: respuesta,
                correcta: ej.a,
                ok: ok,
                fecha: new Date().toISOString()
            });
            
            guardar();
            renderizar();
        }

        function siguiente() {
            const ejs = getEjercicios();
            
            if (!state.correcto && state.similar < 2) {
                state.similar++;
                state.mostrarExp = false;
                state.correcto = null;
            } else {
                state.ejercIdx++;
                state.similar = 0;
                state.mostrarExp = false;
                state.correcto = null;
                
                if (state.ejercIdx >= ejs.length) {
                    alert('Â¡Nivel completado!');
                    volverSubs();
                }
            }
            renderizar();
        }

        function descargar() {
            const h = state.historial;
            const correctos = h.filter(x => x.ok).length;
            const html = `<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>Resultados ${state.nombre}</title>
<style>body{font-family:Arial;padding:20px}table{width:100%;border-collapse:collapse;margin-top:20px}th,td{border:1px solid #ddd;padding:10px}th{background:#f97316;color:white}.ok{background:#d1fae5}.no{background:#fee2e2}</style>
</head><body>
<h1>Resultados de ${state.nombre}</h1>
<p>Fecha: ${new Date().toLocaleDateString('es-ES')}</p>
<table><tr><th>Ejercicio</th><th>Tu Respuesta</th><th>Correcta</th><th>Estado</th></tr>
${h.map(i => `<tr class="${i.ok?'ok':'no'}"><td>${i.pregunta}</td><td>${i.respuesta}</td><td>${i.correcta}</td><td>${i.ok?'âœ…':'âŒ'}</td></tr>`).join('')}
</table>
<p style="margin-top:20px"><strong>Total:</strong> ${h.length} | <strong>Correctos:</strong> ${correctos} | <strong>Acierto:</strong> ${h.length>0?(correctos/h.length*100).toFixed(1):0}%</p>
</body></html>`;
            const blob = new Blob([html], {type: 'text/html'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `resultados_${state.nombre.replace(/\s/g,'_')}.html`;
            a.click();
        }

        function setNombre() {
            const inp = document.getElementById('nameInput');
            if (inp && inp.value.trim()) {
                state.nombre = inp.value.trim();
                guardar();
                renderizar();
            }
        }

        function selBloque(id) { state.bloque = id; state.subbloque = null; renderizar(); }
        function selSub(id) { state.subbloque = id; state.ejercIdx = 0; state.similar = 0; state.mostrarExp = false; state.correcto = null; renderizar(); }
        function volverBloques() { state.bloque = null; state.subbloque = null; renderizar(); }
        function volverSubs() { state.subbloque = null; state.ejercIdx = 0; renderizar(); }
        function inicio() { state.bloque = null; state.subbloque = null; state.ejercIdx = 0; renderizar(); }

        function renderizar() {
            const app = document.getElementById('app');
            
            if (!state.nombre) {
                app.innerHTML = `<div class="min-h-screen flex items-center justify-center p-4">
                    <div class="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full">
                        <div class="text-center mb-6"><div class="text-6xl mb-4">ğŸ“š</div>
                        <h1 class="text-3xl font-bold mb-2">Polinomios</h1>
                        <p class="text-gray-600">Sumas, Restas y MultiplicaciÃ³n</p></div>
                        <label class="block text-gray-700 font-medium mb-2">Tu nombre:</label>
                        <input type="text" id="nameInput" placeholder="Nombre completo" 
                            class="w-full px-4 py-3 border-2 rounded-xl focus:border-orange-500 outline-none mb-4"
                            onkeypress="if(event.key==='Enter')setNombre()">
                        <button onclick="setNombre()" 
                            class="w-full py-3 bg-gradient-to-r from-orange-500 to-blue-500 text-white rounded-xl font-bold">
                            Comenzar
                        </button>
                    </div></div>`;
            } else if (!state.bloque) {
                app.innerHTML = `<div class="container mx-auto p-4 max-w-6xl">
                    <div class="bg-white rounded-3xl shadow-xl p-8 mb-8">
                        <div class="flex justify-between items-center flex-wrap gap-4">
                            <div><h1 class="text-4xl font-bold mb-2">Polinomios</h1>
                            <p class="text-xl text-gray-600">ğŸ‘¤ ${state.nombre}</p></div>
                            <button onclick="descargar()" class="px-6 py-3 bg-green-500 text-white rounded-xl hover:bg-green-600 font-bold shadow-lg">
                                ğŸ“¥ DESCARGAR
                            </button>
                        </div>
                    </div>
                    <h2 class="text-2xl font-bold mb-6">Selecciona un Bloque:</h2>
                    <div class="grid md:grid-cols-2 gap-6">
                        ${Object.entries(BLOQUES).map(([id, b]) => `
                            <div onclick="selBloque('${id}')" 
                                class="bg-gradient-to-br ${b.color} rounded-3xl shadow-xl p-8 cursor-pointer transform hover:scale-105 transition text-white">
                                <div class="text-7xl mb-4">${b.icon}</div>
                                <h3 class="text-3xl font-bold mb-2">${b.nombre}</h3>
                                <div class="text-lg mt-4">Comenzar â†’</div>
                            </div>
                        `).join('')}
                    </div>
                </div>`;
            } else if (!state.subbloque) {
                const b = BLOQUES[state.bloque];
                app.innerHTML = `<div class="container mx-auto p-4 max-w-6xl">
                    <div class="flex gap-3 mb-6">
                        <button onclick="volverBloques()" class="px-6 py-3 bg-white rounded-xl hover:bg-gray-100 shadow-lg">â† Volver</button>
                        <button onclick="descargar()" class="px-6 py-3 bg-green-500 text-white rounded-xl hover:bg-green-600 font-bold shadow-lg">ğŸ“¥</button>
                    </div>
                    <div class="bg-gradient-to-r ${b.color} rounded-3xl shadow-xl p-8 mb-8 text-white">
                        <div class="flex items-center gap-4">
                            <div class="text-6xl">${b.icon}</div>
                            <h2 class="text-4xl font-bold">${b.nombre}</h2>
                        </div>
                    </div>
                    <h3 class="text-2xl font-bold mb-6">Selecciona un Nivel:</h3>
                    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                        ${Object.entries(b.subbloques).map(([id, s]) => `
                            <div onclick="selSub('${id}')" 
                                class="bg-white rounded-2xl shadow-lg p-6 cursor-pointer hover:shadow-2xl hover:scale-105 transition">
                                <h4 class="text-xl font-bold mb-2">${s.nombre}</h4>
                                <div class="text-orange-600 font-medium mt-4">Practicar â†’</div>
                            </div>
                        `).join('')}
                    </div>
                </div>`;
            } else {
                const ejs = getEjercicios();
                const ej = ejs[state.ejercIdx] || {};
                app.innerHTML = `<div class="container mx-auto p-4 max-w-4xl">
                    <div class="flex gap-3 mb-6 flex-wrap">
                        <button onclick="volverSubs()" class="px-6 py-3 bg-white rounded-xl hover:bg-gray-100 shadow-lg">â† Niveles</button>
                        <button onclick="inicio()" class="px-6 py-3 bg-white rounded-xl hover:bg-gray-100 shadow-lg">ğŸ </button>
                        <button onclick="descargar()" class="px-6 py-3 bg-green-500 text-white rounded-xl hover:bg-green-600 font-bold shadow-lg">ğŸ“¥</button>
                    </div>
                    <div class="bg-white rounded-3xl shadow-xl p-8">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">Ejercicio ${state.ejercIdx + 1}/${ejs.length}</h2>
                            ${state.similar > 0 ? `<span class="bg-yellow-100 text-yellow-800 px-4 py-2 rounded-full font-bold">Similar ${state.similar}/2</span>` : ''}
                        </div>
                        <div class="bg-gradient-to-r from-orange-100 to-blue-100 rounded-2xl p-8 mb-6">
                            <div class="text-3xl font-bold text-center mb-2">${ej.q}</div>
                        </div>
                        ${!state.mostrarExp ? `
                            <h3 class="text-xl font-bold mb-4">Selecciona la respuesta correcta:</h3>
                            <div class="grid grid-cols-2 gap-4">
                                ${(ej.opts || []).map(opt => `
                                    <button onclick="verificar('${opt}')" 
                                        class="answer-btn p-6 bg-white border-2 border-gray-300 rounded-xl hover:border-orange-500 hover:shadow-lg text-xl font-medium">
                                        ${opt}
                                    </button>
                                `).join('')}
                            </div>
                        ` : `
                            <div class="p-6 rounded-xl ${state.correcto ? 'bg-green-100 border-2 border-green-400' : 'bg-red-100 border-2 border-red-400'} mb-6">
                                <div class="text-2xl font-bold mb-4">
                                    ${state.correcto ? 'âœ… Â¡Correcto! Excelente' : 'âŒ Incorrecto'}
                                </div>
                                <div class="font-bold text-lg mb-3">ExplicaciÃ³n paso a paso:</div>
                                ${(ej.steps || []).map(s => `<div class="bg-white p-3 rounded-lg mb-2 text-lg">${s}</div>`).join('')}
                            </div>
                            <button onclick="siguiente()" 
                                class="w-full py-4 bg-gradient-to-r from-orange-500 to-blue-500 text-white rounded-xl font-bold text-xl shadow-lg hover:shadow-xl">
                                ${state.correcto ? 'Siguiente Ejercicio â†’' : (state.similar < 2 ? 'Intentar Similar â†’' : 'Ver SoluciÃ³n y Continuar â†’')}
                            </button>
                        `}
                    </div>
                </div>`;
            }
        }

        document.addEventListener('DOMContentLoaded', renderizar);
    </script>
</body>
</html>